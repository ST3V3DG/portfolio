/** biome-ignore-all lint/style/noNonNullAssertion: Allow non null assertions for refs */
"use client";

import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { createContext, useRef, useState } from "react";

export const PagePreloaderContext = createContext<gsap.core.Timeline | undefined>(undefined);

export default function PagePreloader({ children }: { children: React.ReactNode }) {
	const [tl, setTl] = useState<gsap.core.Timeline>();
	const svgLineRef = useRef<SVGPathElement>(null);

	function scrollToTop() {
		window.scrollTo(0, 0);
	}

	gsap.registerPlugin(useGSAP);

	useGSAP(() => {
		const tl = gsap.timeline();
		const preloader = document.getElementById("preloader");

		scrollToTop();

		if (!svgLineRef.current) return;

		gsap.set(svgLineRef.current!.parentElement!.parentElement!, {
			top: "50%",
			left: "50%",
			xPercent: -50,
			yPercent: -50,
		});

		tl.to(svgLineRef.current, {
			strokeDashoffset: 0,
			duration: 3.8,
			ease: "power3.inOut",
		}).to(svgLineRef.current, {
			fill: "var(--accent)",
			duration: 1.2,
			ease: "power2.out",
		}).to(preloader!, {
			opacity: 0,
			duration: 1,
			ease: "power2.inOut",
		})
			.to(svgLineRef.current!.parentElement!.parentElement!, {
				top: "0%",
				left: "0%",
				xPercent: -55,
				transformOrigin: "bottom right",
				scale: 0.35,
				duration: 1,
				ease: "power2.inOut",
				onStart: () => {
					preloader!.nextElementSibling!.classList.remove("bg-background-grainy");
					preloader!.nextElementSibling!.classList.add("bg-transparent", "pointer-events-none");
				},
				onUpdate: () => {
					gsap.set(svgLineRef.current!, {
						fill: "var(--accent)",
						stroke: "var(--accent)",
					});
				},
			}, "<");

		setTl(tl);
	});

	return (
		<PagePreloaderContext.Provider value={tl}>
			<div
				id="preloader"
				className="fixed place-items-center top-0 left-0 z-20 pointer-events-none bg-background h-dvh w-dvw"
			>
			</div>
			<div className="fixed place-items-center top-0 -translate-x-1/2 left-1/2 z-20 bg-background-grainy h-dvh w-dvw">
				<div className="size-full max-w-7xl relative">
					<svg aria-label="logo" className="absolute pointer-events-none" width="280" height="80" viewBox="0 0 281 82" fill="none" xmlns="http://www.w3.org/2000/svg"
						role="img">
						<g>
							<path className="fill-transparent stroke-accent" style={{ strokeDasharray: 400, strokeDashoffset: 400 }} ref={svgLineRef} d="M19.712 81.92C19.1147 81.92 18.4747 81.92 17.792 81.92C17.1947 81.92 16.6827 81.8773 16.256 81.792C15.488 81.7067 14.208 81.408 12.416 80.896C10.624 80.384 8.74669 79.7013 6.78402 78.848C4.90669 78.08 3.28535 77.184 1.92002 76.16C0.640022 75.136 2.19345e-05 74.0267 2.19345e-05 72.832C2.19345e-05 72.32 0.298689 72.064 0.896022 72.064C2.34669 72.064 3.79736 72.448 5.24802 73.216C6.78402 73.984 8.36269 74.4533 9.98402 74.624C10.6667 74.7093 11.392 74.7947 12.16 74.88C13.0134 74.88 13.952 74.88 14.976 74.88C17.1094 74.88 19.328 74.7093 21.632 74.368C23.936 73.9413 25.8987 73.216 27.52 72.192C29.1414 71.168 29.9947 69.7173 30.08 67.84C30.08 66.6453 29.312 65.152 27.776 63.36C26.24 61.4827 24.2774 59.3493 21.888 56.96C19.584 54.4853 17.28 51.7973 14.976 48.896C12.672 45.9093 10.7094 42.7093 9.08802 39.296C7.55202 35.8827 6.78402 32.3413 6.78402 28.672C6.78402 24.064 7.89336 20.0533 10.112 16.64C12.3307 13.2267 15.232 10.4533 18.816 8.31999C22.4 6.10132 26.3254 4.47999 30.592 3.45599C34.8587 2.34666 39.04 1.79199 43.136 1.79199C45.184 1.79199 47.104 1.91999 48.896 2.17599C51.2 2.43199 53.6747 3.02932 56.32 3.96799C59.0507 4.82132 61.3974 6.18666 63.36 8.06399C65.3227 9.85599 66.304 12.2453 66.304 15.232C66.304 18.3893 65.28 21.4187 63.232 24.32C61.2694 27.2213 58.8374 29.7813 55.936 32C53.12 34.1333 50.3467 35.7547 47.616 36.864C47.104 37.12 46.592 37.248 46.08 37.248C45.6534 37.0773 45.44 36.864 45.44 36.608C45.8667 35.6693 46.8907 34.3893 48.512 32.768C50.2187 31.0613 52.0534 29.184 54.016 27.136C56.064 25.088 57.8134 22.912 59.264 20.608C60.8 18.2187 61.568 15.872 61.568 13.568C61.568 12.032 61.0134 10.88 59.904 10.112C58.7947 9.25866 57.472 8.61866 55.936 8.19199C54.4854 7.76532 53.2054 7.46665 52.096 7.29599C51.584 7.21066 51.072 7.16799 50.56 7.16799C50.048 7.16799 49.4934 7.16799 48.896 7.16799C45.056 7.16799 40.9174 7.85066 36.48 9.21599C32.128 10.496 27.9894 12.3307 24.064 14.72C20.1387 17.1093 16.9387 19.968 14.464 23.296C11.9894 26.5387 10.752 30.1653 10.752 34.176C10.752 36.5653 11.6054 39.1253 13.312 41.856C15.0187 44.5013 17.152 47.232 19.712 50.048C22.272 52.864 24.832 55.68 27.392 58.496C29.952 61.2267 32.0854 63.9147 33.792 66.56C35.4987 69.12 36.352 71.5093 36.352 73.728C36.352 75.8613 35.4134 77.5253 33.536 78.72C31.744 79.9147 29.5254 80.7253 26.88 81.152C24.32 81.664 21.9307 81.92 19.712 81.92ZM60.063 80.896C58.527 80.896 57.2044 80.384 56.095 79.36C55.071 78.336 54.2604 77.0987 53.663 75.648C53.151 74.112 52.895 72.6613 52.895 71.296C52.895 69.9307 53.0657 68.608 53.407 67.328C53.7484 65.9627 54.2177 64.64 54.815 63.36C55.9244 60.8853 57.247 58.1547 58.783 55.168C60.4044 52.096 62.111 48.9813 63.903 45.824C65.7804 42.5813 67.6577 39.6373 69.535 36.992C68.0844 37.5893 66.3777 38.272 64.415 39.04C62.5377 39.7227 61.3004 40.064 60.703 40.064C60.3617 39.9787 60.1057 39.7227 59.935 39.296C59.8497 38.8693 59.807 38.4427 59.807 38.016C59.807 36.224 60.6604 35.0293 62.367 34.432C65.0124 33.5787 68.5537 32.8107 72.991 32.128C76.2337 27.8613 79.7324 23.5947 83.487 19.328C87.327 15.0613 91.2097 11.6907 95.135 9.21599C95.903 8.70399 96.7564 8.95999 97.695 9.98399C98.6337 10.9227 99.1457 11.904 99.231 12.928C99.231 13.8667 98.8897 14.5067 98.207 14.848C94.7937 16.9813 91.6364 19.4133 88.735 22.144C85.8337 24.7893 82.847 27.8187 79.775 31.232C81.4817 30.976 82.975 30.8053 84.255 30.72C85.535 30.6347 86.3457 30.592 86.687 30.592C86.943 30.592 87.3697 30.592 87.967 30.592C88.5644 30.5067 89.2044 30.464 89.887 30.464C90.911 30.464 91.8497 30.5493 92.703 30.72C93.6417 30.8907 94.111 31.1893 94.111 31.616C94.111 31.9573 93.727 32.256 92.959 32.512C92.2764 32.6827 91.5084 32.8107 90.655 32.896C89.8017 32.896 89.1617 32.9387 88.735 33.024C86.175 33.3653 83.871 33.7067 81.823 34.048C79.8604 34.3893 78.0257 34.816 76.319 35.328C74.3564 37.7173 72.8204 39.7227 71.711 41.344C70.687 42.9653 69.791 44.4587 69.023 45.824C68.3404 47.104 67.487 48.5547 66.463 50.176C64.2444 54.4427 62.3244 58.7947 60.703 63.232C59.167 67.6693 58.399 71.2533 58.399 73.984C58.399 74.4107 58.4417 74.752 58.527 75.008C58.6124 75.264 58.8684 75.392 59.295 75.392C59.807 75.392 60.2764 75.264 60.703 75.008C61.215 74.6667 61.6417 74.3253 61.983 73.984C63.1777 73.0453 64.287 71.9787 65.311 70.784C66.4204 69.504 67.487 68.3093 68.511 67.2C70.3884 65.152 72.3084 63.1467 74.271 61.184C76.2337 59.2213 78.1537 57.2587 80.031 55.296C80.2017 55.1253 80.3724 54.9973 80.543 54.912C80.7137 54.7413 80.8844 54.656 81.055 54.656C81.6524 54.656 81.951 54.9973 81.951 55.68C81.951 55.936 81.7804 56.32 81.439 56.832C80.415 58.1973 79.3057 59.5627 78.111 60.928C76.9164 62.208 75.7644 63.5307 74.655 64.896C72.4364 67.5413 70.2177 70.144 67.999 72.704C65.8657 75.264 63.7324 77.9093 61.599 80.64C61.343 80.7253 61.087 80.768 60.831 80.768C60.575 80.8533 60.319 80.896 60.063 80.896ZM82.741 76.416C77.621 76.416 75.061 73.8987 75.061 68.864C75.061 66.9013 75.573 64.64 76.597 62.08C77.7064 59.4347 79.157 56.7893 80.949 54.144C82.741 51.4987 84.7464 49.0667 86.965 46.848C89.1837 44.544 91.445 42.7093 93.749 41.344C96.1384 39.8933 98.357 39.168 100.405 39.168C101.088 39.168 101.557 39.3387 101.813 39.68C102.154 39.936 102.41 40.4053 102.581 41.088C102.752 41.4293 102.88 41.8133 102.965 42.24C103.05 42.6667 103.178 43.0933 103.349 43.52C103.69 44.1173 103.989 44.7147 104.245 45.312C104.501 45.9093 104.629 46.5493 104.629 47.232C104.629 48.0853 104.416 48.8533 103.989 49.536C103.562 50.1333 103.05 50.688 102.453 51.2C101.6 51.968 100.32 52.9493 98.613 54.144C96.9064 55.2533 95.029 56.4053 92.981 57.6C91.0184 58.7093 89.0984 59.6907 87.221 60.544C85.429 61.3973 83.9784 61.9093 82.869 62.08C82.101 63.2747 81.2904 64.768 80.437 66.56C79.669 68.2667 79.285 69.8453 79.285 71.296C79.285 72.064 79.4557 72.7467 79.797 73.344C80.2237 73.9413 80.8637 74.24 81.717 74.24C83.0824 74.24 84.8744 73.6 87.093 72.32C89.397 70.9547 91.7864 69.3333 94.261 67.456C96.7357 65.4933 98.997 63.616 101.045 61.824C103.178 59.9467 104.757 58.496 105.781 57.472L109.877 53.12C110.389 52.608 110.944 52.352 111.541 52.352C112.053 52.352 112.309 52.5653 112.309 52.992C112.309 53.504 111.584 54.5707 110.133 56.192C108.682 57.728 106.933 59.4773 104.885 61.44C102.922 63.3173 101.088 65.0667 99.381 66.688C97.6744 68.224 96.565 69.2053 96.053 69.632C94.261 71.168 92.213 72.704 89.909 74.24C87.605 75.6907 85.2157 76.416 82.741 76.416ZM85.045 58.752C85.8984 58.24 87.1784 57.4293 88.885 56.32C90.677 55.2107 92.5117 53.9733 94.389 52.608C96.2664 51.2427 97.845 49.8773 99.125 48.512C100.49 47.1467 101.173 45.952 101.173 44.928C101.173 44.672 101.13 44.4587 101.045 44.288C100.96 44.2027 100.789 44.16 100.533 44.16C99.4237 44.16 98.101 44.7573 96.565 45.952C95.029 47.1467 93.493 48.5973 91.957 50.304C90.421 51.9253 89.013 53.5467 87.733 55.168C86.5384 56.704 85.6424 57.8987 85.045 58.752ZM106.904 77.056C105.539 76.8 104.557 76.672 103.96 76.672C103.448 76.672 102.723 75.9893 101.784 74.624C101.699 74.4533 101.613 74.24 101.528 73.984C101.528 73.728 101.528 73.5147 101.528 73.344C101.528 72.064 101.912 70.1867 102.68 67.712C103.533 65.2373 104.515 62.592 105.624 59.776C106.819 56.96 107.971 54.3573 109.08 51.968C110.189 49.4933 111.043 47.5733 111.64 46.208C111.811 45.8667 111.896 45.6107 111.896 45.44C111.896 45.0133 111.64 44.8 111.128 44.8C110.701 44.7147 110.488 44.3733 110.488 43.776C110.915 43.0933 111.469 42.24 112.152 41.216C112.92 40.192 113.731 39.296 114.584 38.528C115.523 37.76 116.419 37.376 117.272 37.376C117.955 37.376 118.851 37.888 119.96 38.912C121.069 39.8507 121.624 40.6613 121.624 41.344C121.624 41.4293 121.581 41.5147 121.496 41.6C121.496 41.6 121.496 41.6427 121.496 41.728C120.216 43.0933 118.893 44.9707 117.528 47.36C116.163 49.7493 114.883 52.352 113.688 55.168C112.493 57.8987 111.469 60.5867 110.616 63.232C109.848 65.8773 109.336 68.1387 109.08 70.016C111.725 67.5413 114.499 64.9387 117.4 62.208C120.387 59.392 123.245 56.6187 125.976 53.888C128.707 51.072 131.011 48.4693 132.888 46.08C133.059 44.8853 133.229 43.7333 133.4 42.624C133.656 41.5147 134.125 40.2347 134.808 38.784C135.149 38.1013 135.619 37.504 136.216 36.992C136.899 36.3947 137.709 36.096 138.648 36.096C139.416 36.096 140.184 36.352 140.952 36.864C141.72 37.2907 142.104 37.888 142.104 38.656C142.104 39.68 141.72 40.6187 140.952 41.472C140.184 42.24 139.416 43.3067 138.648 44.672C137.88 46.0373 137.496 48 137.496 50.56C137.496 52.864 137.837 54.8693 138.52 56.576C139.288 58.2827 140.227 59.4773 141.336 60.16C142.872 56.832 144.92 53.5893 147.48 50.432C150.125 47.1893 152.941 44.5013 155.928 42.368C158.915 40.2347 161.688 39.168 164.248 39.168C164.931 39.168 165.4 39.3387 165.656 39.68C165.997 39.936 166.253 40.4053 166.424 41.088C166.595 41.4293 166.723 41.8133 166.808 42.24C166.893 42.6667 167.021 43.0933 167.192 43.52C167.533 44.1173 167.832 44.7147 168.088 45.312C168.344 45.9093 168.472 46.5493 168.472 47.232C168.472 48.0853 168.259 48.8533 167.832 49.536C167.405 50.1333 166.893 50.688 166.296 51.2C165.443 51.968 164.163 52.9493 162.456 54.144C160.749 55.2533 158.872 56.4053 156.824 57.6C154.861 58.7093 152.941 59.6907 151.064 60.544C149.272 61.3973 147.821 61.9093 146.712 62.08C145.944 63.2747 145.133 64.768 144.28 66.56C143.512 68.2667 143.128 69.8453 143.128 71.296C143.128 72.064 143.299 72.7467 143.64 73.344C144.067 73.9413 144.707 74.24 145.56 74.24C146.925 74.24 148.717 73.6 150.936 72.32C153.24 70.9547 155.629 69.3333 158.104 67.456C160.579 65.4933 162.84 63.616 164.888 61.824C167.021 59.9467 168.6 58.496 169.624 57.472L173.72 53.12C174.232 52.608 174.787 52.352 175.384 52.352C175.896 52.352 176.152 52.5653 176.152 52.992C176.152 53.504 175.427 54.5707 173.976 56.192C172.525 57.728 170.776 59.4773 168.728 61.44C166.765 63.3173 164.931 65.0667 163.224 66.688C161.517 68.224 160.408 69.2053 159.896 69.632C158.104 71.168 156.056 72.704 153.752 74.24C151.448 75.6907 149.059 76.416 146.584 76.416C141.464 76.416 138.904 73.8987 138.904 68.864C138.904 66.9867 139.416 64.7253 140.44 62.08C138.221 61.3973 136.557 59.904 135.448 57.6C134.339 55.296 133.613 52.5653 133.272 49.408C129.347 53.3333 125.165 57.856 120.728 62.976C116.376 68.0107 111.768 72.704 106.904 77.056ZM148.888 58.752C149.741 58.24 151.021 57.4293 152.728 56.32C154.52 55.2107 156.355 53.9733 158.232 52.608C160.109 51.2427 161.688 49.8773 162.968 48.512C164.333 47.1467 165.016 45.952 165.016 44.928C165.016 44.672 164.973 44.4587 164.888 44.288C164.803 44.2027 164.632 44.16 164.376 44.16C163.267 44.16 161.944 44.7573 160.408 45.952C158.872 47.1467 157.336 48.5973 155.8 50.304C154.264 51.9253 152.856 53.5467 151.576 55.168C150.381 56.704 149.485 57.8987 148.888 58.752ZM179.099 77.056C178.331 77.056 177.392 76.8853 176.283 76.544C175.174 76.2027 174.619 75.4347 174.619 74.24C174.619 73.472 174.96 72.576 175.643 71.552C176.411 70.4427 177.307 69.504 178.331 68.736C179.355 67.8827 180.294 67.456 181.147 67.456C181.83 67.456 182.47 67.7547 183.067 68.352C183.75 68.9493 184.048 69.6747 183.963 70.528C183.963 70.9547 183.622 71.7227 182.939 72.832C182.342 73.856 181.659 74.8373 180.891 75.776C180.208 76.6293 179.611 77.056 179.099 77.056ZM222.723 76.416C222.126 76.416 221.102 76.288 219.651 76.032C218.286 75.6907 216.963 75.3067 215.683 74.88C214.488 74.368 213.848 73.856 213.763 73.344C213.763 72.832 214.232 72.4907 215.171 72.32C216.195 72.1493 217.219 72.064 218.243 72.064C219.352 71.9787 219.992 71.936 220.163 71.936C223.32 71.936 226.947 71.3387 231.043 70.144C235.139 68.9493 239.363 67.2853 243.715 65.152C248.067 63.0187 252.248 60.544 256.259 57.728C260.27 54.912 263.854 51.84 267.011 48.512C270.254 45.0987 272.728 41.6 274.435 38.016C276.142 34.432 276.782 30.848 276.355 27.264C275.843 22.8267 274.52 19.2427 272.387 16.512C270.339 13.696 267.694 11.52 264.451 9.98399C261.294 8.36266 257.838 7.21066 254.083 6.52799C250.414 5.84532 246.702 5.41866 242.947 5.24799C239.192 5.07732 235.694 4.99199 232.451 4.99199C229.294 4.99199 226.051 5.07732 222.723 5.24799C219.395 5.41866 216.28 5.97332 213.379 6.91199C212.526 7.16799 211.672 7.42399 210.819 7.67999C209.966 7.93599 209.07 8.06399 208.131 8.06399C208.046 8.06399 207.79 8.06399 207.363 8.06399C206.936 7.97866 206.723 7.80799 206.723 7.55199C206.552 6.35732 207.107 5.33332 208.387 4.47999C209.667 3.62666 211.288 2.90132 213.251 2.30399C215.299 1.70666 217.39 1.23732 219.523 0.895988C221.742 0.554654 223.747 0.341321 225.539 0.255989C227.331 0.0853246 228.611 -7.62939e-06 229.379 -7.62939e-06C233.39 -7.62939e-06 237.614 0.213326 242.051 0.639992C246.488 0.981326 250.883 1.74933 255.235 2.94399C259.587 4.05332 263.598 5.67465 267.267 7.80799C270.936 9.94132 273.966 12.7573 276.355 16.256C278.744 19.7547 280.238 24.1067 280.835 29.312C280.92 29.824 280.963 30.336 280.963 30.848C280.963 31.36 280.963 31.8293 280.963 32.256C280.963 37.376 279.683 42.1973 277.123 46.72C274.648 51.1573 271.278 55.2107 267.011 58.88C262.83 62.464 258.179 65.5787 253.059 68.224C247.939 70.8693 242.734 72.9173 237.443 74.368C232.152 75.7333 227.246 76.416 222.723 76.416ZM206.723 79.104C205.614 79.104 204.675 78.592 203.907 77.568C203.139 76.6293 202.584 75.52 202.243 74.24C201.902 72.96 201.731 71.9787 201.731 71.296C201.731 69.248 202.371 66.304 203.651 62.464C205.016 58.5387 206.766 54.1867 208.899 49.408C211.118 44.544 213.55 39.68 216.195 34.816C218.926 29.8667 221.614 25.344 224.259 21.248C226.99 17.0667 229.55 13.7387 231.939 11.264C234.328 8.70399 236.291 7.42399 237.827 7.42399C238.68 7.42399 239.875 7.85065 241.411 8.70399C242.947 9.55732 243.758 10.4533 243.843 11.392C243.928 11.7333 242.99 13.056 241.027 15.36C239.15 17.5787 236.718 20.48 233.731 24.064C230.744 27.5627 227.587 31.4453 224.259 35.712C221.016 39.9787 217.944 44.3307 215.043 48.768C212.142 53.2053 209.838 57.472 208.131 61.568C206.424 65.5787 205.742 69.12 206.083 72.192C206.168 72.704 206.296 73.1307 206.467 73.472C206.638 73.8133 207.022 73.984 207.619 73.984C208.558 73.984 209.368 73.728 210.051 73.216C210.734 72.6187 211.203 72.32 211.459 72.32C211.63 72.32 211.715 72.448 211.715 72.704C211.8 72.8747 211.843 72.96 211.843 72.96C212.014 74.4107 211.544 75.8187 210.435 77.184C209.411 78.464 208.174 79.104 206.723 79.104Z" />
						</g>
					</svg>
				</div>
			</div>
			{children}
		</PagePreloaderContext.Provider >
	);
}
